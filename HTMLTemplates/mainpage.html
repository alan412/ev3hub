<%def name="scripts()">

</%def>

<%def name="title()">EV3Hub - ${project}</%def>
<%inherit file="base.html"/>

<div class="top">
	<div class="project">
	    <button id="projBtn" class="projbtn">Project: ${project}</button>
	</div>
	<div class="title">
		<IMG class="logo" height=60px src="static/splash.png"/>
		<P class="title">EV3Hub</P>
		<IMG class="logo" height=60px src="static/splash.png"/>
	</div>
	<div class="dropdown">
	  <button class="dropbtn">Logged in: ${username}</button>	  
	  <div class="dropdown-content">
		<p id="settings">Account Settings</p>
	    <p id="logout">Logout</p>
	  </div>
	</div>	
</div>

<TABLE class=spacing width="100%">
<TR>
<TD with="5%"/>
<TD width="40%" align="center"><P class="large" id="download">&darr; Download &darr;</P></TD>
<TD/>
<TD width="40%" align="center"><P class="large" id="upload">&uarr; Upload (Commit) &uarr;</P></TD>
<TD with="5%"/>
</TR>
</TABLE>
<button id="diffBtn">Show Diff</button>


<TABLE class="commits" width="100%" border="1">
<TR><TH>1</TH><TH>2</TH><TH>id</TH><TH>parent</TH><TH>Comments</TH><TH>Time</TH><TH>Who</TH><TH>Host</TH></TR>
	% for commit in commits:
	   % if "{0}".format(commit.cid()) in failedMerges: 
	      <TR class="failedMerge">
  		    <TD class="commits"><input type="radio" name="cid1" value="${commit.cid()}"></TD> 
  			<TD class="commits"><input type="radio" name="cid2" value="${commit.cid()}"></TD>
	   % elif "{0}".format(commit.cid()) == "{0}".format(head):
	      <TR class="head">
  		    <TD class="commits"><input type="radio" name="cid1" value="${commit.cid()}" checked="checked"></TD> 
  			<TD class="commits"><input type="radio" name="cid2" value="${commit.cid()}" checked="checked"></TD>
	   % else:
	      <TR class="commits">
  		    <TD class="commits"><input type="radio" name="cid1" value="${commit.cid()}"></TD> 
  			<TD class="commits"><input type="radio" name="cid2" value="${commit.cid()}"></TD>
	   % endif
			<TD class="commits"><A HREF="download?cid=${commit.cid()}">${commit.cid()}</TD></A> 
			<TD class="commits">${commit.parent()}</TD>
			<TD class="commits">${commit.comment()}</TD> 
			<TD class="commits">${commit.timeStr()}</TD> 
			<TD class="commits">${commit.name()}</TD> 
			<TD class="commits">${commit.host()}</TD> </TR>
	% endfor
</TABLE>	
<script>
// Get the modal
var modal = document.getElementById('modal');

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// Get the button that opens the modal
var diffBtn = document.getElementById("diffBtn");

var settings = document.getElementById("settings");
var logout = document.getElementById("logout");
var upload = document.getElementById("upload");
var download = document.getElementById("download");
var projectBtn = document.getElementById("projBtn")

upload.onclick = function() {
	$("#modal-header").html("Upload (Commit) - ${project}");
	
	$.get("upload", function(result){
		$("#modal-body").html(result);
	} );
    modal.style.display = "block";	
}

download.onclick = function(){
	window.location = "download?cid=head"
}

projectBtn.onclick = function(){
	window.location = "projects"
}

// When the user clicks on the button, open the modal 
diffBtn.onclick = function() {
	$("#modal-header").html("Diff - ${project}");
	
	var cid1_val = $("input[name=cid1]:checked").val();
	var cid2_val = $("input[name=cid2]:checked").val();

	$.post("diff", {cid1: cid1_val, cid2:cid2_val}, function(result){
		$("#modal-body").html(result);
	} );
    modal.style.display = "block";
}

logout.onclick = function(){
	window.location.assign("logout")
}
var email_start_val = "${email}";

// When the user clicks on settings, open modal
settings.onclick = function(){
	$("#modal-header").html("Account Settings - ${username}");
	$("#modal-body").html("<P>Only fill in the new password fields if you wish to change your password</P>" +
"<table>"+
'<tr><td>Email:</td><td><input type="text" name="email" value="'+email_start_val+'"/></td></tr>'+
'<tr><td>New Password:</td><td><input type="password" name="newPassword"  placeholder="new password" /></td></tr>'+
'<tr><td>New Password (again):</td><td><input type="password" name="newPassword2"  placeholder="new password" /></td></tr>'+
'<tr><td>Current Password:</td><td><input type="password" name="password" placeholder="current password"></td></tr>'+
"</table>"+
'<br/><input type="submit" onclick="updateSettings()" value="Update"/>'		
	);
	modal.style.display = "block";
}

function updateSettings(){
	var email_val = $("input[name=email]").val();
	var newpw1_val = $("input[name=newPassword]").val();
	var newpw2_val = $("input[name=newPassword2]").val();
	var pw_val = $("input[name=password]").val();
			
	$.post("updateSettings", {email: email_val, newpw1 : newpw1_val, newpw2 : newpw2_val, password : pw_val}, function(result){
		if (!$.trim(result)){   
		    modal.style.display = "none"; // everything is good :-)
			if(email_val){
				email_start_val = email_val;
			}
		}
		else{   
		    alert(result);
		}
	});
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>